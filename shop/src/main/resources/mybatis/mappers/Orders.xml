<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.mapper.OrderMapper" >

	<insert id="insertOrder" parameterType="com.example.vo.Order">
		<selectKey keyProperty="no" resultType="int" order="BEFORE"> <!-- 시퀀스로 획득한 번호를 Order객체에 담아놓고 다른 테이블에서도 동시에 생성할 수 있도록 -->
			select
				orders_seq.nextval
			from
				dual
		</selectKey>
		insert into shop_orders
		(order_no, user_no, order_total_price)
		values
		(#{no}, #{user.no}, #{totalPrice})
	</insert>
	
	<select id="getOrdersByUserNo" parameterType="int" resultType="com.example.vo.Order">
		select
			order_no			as no,
			order_date			as orderDate,
			order_total_price	as totalPrice,
			order_status		as status,
			order_updated_date	as updatedDate
		from
			shop_orders
		where
			user_no = #{value}
		order by
			order_no desc
	</select>
	
	<select id="getOrderByNo" parameterType="int" resultType="com.example.vo.Order">
		select
			order_no			as no,
			order_date			as orderDate,
			order_total_price	as totalPrice,
			order_status		as status,
			order_updated_date	as updatedDate,
			user_no				as "user.no"
		from
			shop_orders
		where
			order_no = #{value}
	</select>
</mapper>